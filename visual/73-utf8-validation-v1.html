<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UTF-8 Validation</title>
    <link rel="stylesheet" href="visual.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
</head>
<body>
    <div class="container">
        <h1>ğŸ”¤ UTF-8 Validation</h1>
        <p class="subtitle">Check if byte sequence is valid UTF-8 encoding</p>

        <div class="controls">
            <button id="stepBtn">Step</button>
            <button id="autoBtn">Auto Run</button>
            <button id="resetBtn">Reset</button>
        </div>

        <div class="panel">
            <div class="panel-title">ğŸ“Š Byte Sequence</div>
            <div class="bytes-container" id="bytes"></div>
        </div>

        <div class="panel">
            <div class="panel-title">ğŸ“œ UTF-8 Encoding Rules</div>
            <div class="rules-grid">
                <div class="rule-item">
                    <div class="rule-pattern">0xxxxxxx</div>
                    <div class="rule-desc">1-byte char (ASCII, 0-127)</div>
                </div>
                <div class="rule-item">
                    <div class="rule-pattern">110xxxxx 10xxxxxx</div>
                    <div class="rule-desc">2-byte char</div>
                </div>
                <div class="rule-item">
                    <div class="rule-pattern">1110xxxx 10xxxxxx 10xxxxxx</div>
                    <div class="rule-desc">3-byte char</div>
                </div>
                <div class="rule-item">
                    <div class="rule-pattern">11110xxx 10xxxxxx 10xxxxxx 10xxxxxx</div>
                    <div class="rule-desc">4-byte char</div>
                </div>
            </div>
        </div>

        <div class="panel">
            <div class="panel-title">âœ… Result</div>
            <div class="result-box result-pending" id="result-box">
                <div class="result-value" id="result">Pending...</div>
            </div>
        </div>

        <div class="panel">
            <div class="panel-title">ğŸ“‹ Status</div>
            <div class="status-box" id="status">Check each byte: leading byte determines char length, continuation bytes start with 10.</div>
        </div>
    
        <div class="code-section">
            <h3>ğŸ“„ Python Solution (73-1.py)</h3>
            <pre><span class="keyword">from</span> typing <span class="keyword">import</span> List


<span class="keyword">class</span> Solution:
    <span class="keyword">def</span> <span class="function">validUtf8</span>(<span class="keyword">self</span>, data: List[int]) -&gt; bool:
        <span class="comment"># ë¬¸ì ë°”ì´íŠ¸ ë§Œí¼ 10ìœ¼ë¡œ ì‹œì‘ íŒë³„</span>
        <span class="keyword">def</span> <span class="function">check</span>(size):
            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="function">range</span>(start + <span class="number">1</span>, start + size + <span class="number">1</span>):
                <span class="keyword">if</span> i &gt;= <span class="function">len</span>(data) <span class="keyword">or</span> (data[i] &gt;&gt; <span class="number">6</span>) != 0b10:
                    <span class="keyword">return</span> <span class="keyword">False</span>
            <span class="keyword">return</span> <span class="keyword">True</span>

        start = <span class="number">0</span>
        <span class="keyword">while</span> start &lt; <span class="function">len</span>(data):
            <span class="comment"># ì²« ë°”ì´íŠ¸ ê¸°ì¤€ ì´ ë¬¸ì ë°”ì´íŠ¸ íŒë³„</span>
            first = data[start]
            <span class="keyword">if</span> (first &gt;&gt; <span class="number">3</span>) == 0b11110 <span class="keyword">and</span> <span class="function">check</span>(<span class="number">3</span>):
                start += <span class="number">4</span>
            <span class="keyword">elif</span> (first &gt;&gt; <span class="number">4</span>) == 0b1110 <span class="keyword">and</span> <span class="function">check</span>(<span class="number">2</span>):
                start += <span class="number">3</span>
            <span class="keyword">elif</span> (first &gt;&gt; <span class="number">5</span>) == 0b110 <span class="keyword">and</span> <span class="function">check</span>(<span class="number">1</span>):
                start += <span class="number">2</span>
            <span class="keyword">elif</span> (first &gt;&gt; <span class="number">7</span>) == <span class="number">0</span>:
                start += <span class="number">1</span>
            <span class="keyword">else</span>:
                <span class="keyword">return</span> <span class="keyword">False</span>
        <span class="keyword">return</span> <span class="keyword">True</span></pre>
        </div>

    </div>


    <script>
        const data = [197, 130, 1];  // Valid: 2-byte char + 1-byte char
        let idx = 0;
        let remaining = 0;
        let byteStates = new Array(data.length).fill('default');
        let done = false;
        let valid = true;
        let autoInterval = null;

        function toBinary(n) {
            return (n >>> 0).toString(2).padStart(8, '0');
        }

        function getByteType(n) {
            if ((n & 0x80) === 0) return '1-byte (ASCII)';
            if ((n & 0xE0) === 0xC0) return 'Lead: 2-byte';
            if ((n & 0xF0) === 0xE0) return 'Lead: 3-byte';
            if ((n & 0xF8) === 0xF0) return 'Lead: 4-byte';
            if ((n & 0xC0) === 0x80) return 'Continuation';
            return 'Invalid';
        }

        function render() {
            document.getElementById('bytes').innerHTML = data.map((v, i) => {
                return `<div class="byte-item ${byteStates[i]}">
                    <div class="byte-decimal">${v}</div>
                    <div class="byte-binary">${toBinary(v)}</div>
                    <div class="byte-type">${getByteType(v)}</div>
                </div>`;
            }).join('');
        }

        function step() {
            if (done) return;

            if (idx >= data.length) {
                if (remaining > 0) {
                    valid = false;
                    document.getElementById('status').innerHTML = 
                        `âŒ Invalid! Expected ${remaining} more continuation bytes.`;
                } else {
                    document.getElementById('status').innerHTML = 
                        `âœ… Valid UTF-8 encoding!`;
                }
                done = true;
                const resultBox = document.getElementById('result-box');
                resultBox.className = `result-box ${valid ? 'result-valid' : 'result-invalid'}`;
                document.getElementById('result').textContent = valid ? 'Valid UTF-8' : 'Invalid UTF-8';
                document.getElementById('stepBtn').disabled = true;
                document.getElementById('autoBtn').disabled = true;
                stopAuto();
                render();
                return;
            }

            const byte = data[idx];
            byteStates[idx] = 'current';
            render();

            if (remaining > 0) {
                // Expecting continuation byte
                if ((byte & 0xC0) === 0x80) {
                    remaining--;
                    byteStates[idx] = 'valid';
                    document.getElementById('status').innerHTML = 
                        `Byte ${idx}: ${toBinary(byte)} - Valid continuation byte. ${remaining} more expected.`;
                } else {
                    valid = false;
                    byteStates[idx] = 'invalid';
                    done = true;
                    document.getElementById('status').innerHTML = 
                        `âŒ Byte ${idx}: Expected continuation (10xxxxxx), got ${toBinary(byte)}`;
                    const resultBox = document.getElementById('result-box');
                    resultBox.className = 'result-box result-invalid';
                    document.getElementById('result').textContent = 'Invalid UTF-8';
                    document.getElementById('stepBtn').disabled = true;
                    document.getElementById('autoBtn').disabled = true;
                    stopAuto();
                }
            } else {
                // Expecting leading byte
                if ((byte & 0x80) === 0) {
                    byteStates[idx] = 'valid';
                    document.getElementById('status').innerHTML = 
                        `Byte ${idx}: ${toBinary(byte)} - 1-byte ASCII character.`;
                } else if ((byte & 0xE0) === 0xC0) {
                    remaining = 1;
                    byteStates[idx] = 'valid';
                    document.getElementById('status').innerHTML = 
                        `Byte ${idx}: ${toBinary(byte)} - Start of 2-byte character. Need 1 continuation.`;
                } else if ((byte & 0xF0) === 0xE0) {
                    remaining = 2;
                    byteStates[idx] = 'valid';
                    document.getElementById('status').innerHTML = 
                        `Byte ${idx}: ${toBinary(byte)} - Start of 3-byte character. Need 2 continuations.`;
                } else if ((byte & 0xF8) === 0xF0) {
                    remaining = 3;
                    byteStates[idx] = 'valid';
                    document.getElementById('status').innerHTML = 
                        `Byte ${idx}: ${toBinary(byte)} - Start of 4-byte character. Need 3 continuations.`;
                } else {
                    valid = false;
                    byteStates[idx] = 'invalid';
                    done = true;
                    document.getElementById('status').innerHTML = 
                        `âŒ Byte ${idx}: Invalid leading byte pattern ${toBinary(byte)}`;
                    const resultBox = document.getElementById('result-box');
                    resultBox.className = 'result-box result-invalid';
                    document.getElementById('result').textContent = 'Invalid UTF-8';
                    document.getElementById('stepBtn').disabled = true;
                    document.getElementById('autoBtn').disabled = true;
                    stopAuto();
                }
            }

            idx++;
            render();
        }

        function reset() {
            stopAuto();
            idx = 0;
            remaining = 0;
            byteStates = new Array(data.length).fill('default');
            done = false;
            valid = true;
            document.getElementById('result-box').className = 'result-box result-pending';
            document.getElementById('result').textContent = 'Pending...';
            document.getElementById('stepBtn').disabled = false;
            document.getElementById('autoBtn').disabled = false;
            document.getElementById('status').innerHTML = 'Check each byte: leading byte determines char length, continuation bytes start with 10.';
            render();
        }

        function stopAuto() {
            if (autoInterval) { clearInterval(autoInterval); autoInterval = null; }
            document.getElementById('autoBtn').textContent = 'Auto Run';
        }

        document.getElementById('stepBtn').onclick = () => { stopAuto(); step(); };
        document.getElementById('autoBtn').onclick = () => {
            if (autoInterval) { stopAuto(); }
            else { autoInterval = setInterval(step, 800); document.getElementById('autoBtn').textContent = 'â¸ Pause'; }
        };
        document.getElementById('resetBtn').onclick = reset;

        render();
    </script>
</body>
</html>
