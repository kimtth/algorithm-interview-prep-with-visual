<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Different Ways to Add Parentheses</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; }
        h1 { text-align: center; color: white; margin-bottom: 10px; }
        .subtitle { text-align: center; color: rgba(255,255,255,0.9); margin-bottom: 20px; font-size: 14px; }
        .controls { display: flex; justify-content: center; gap: 15px; margin-bottom: 20px; }
        button { background: white; color: #667eea; border: none; padding: 10px 25px; border-radius: 25px; cursor: pointer; font-weight: 600; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .panel { background: white; border-radius: 15px; padding: 20px; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .panel-title { font-size: 16px; font-weight: bold; color: #333; margin-bottom: 15px; border-bottom: 2px solid #667eea; padding-bottom: 10px; }
        .expression { text-align: center; font-size: 32px; font-weight: bold; color: #667eea; font-family: monospace; padding: 20px; background: #f5f7fa; border-radius: 10px; }
        .ways-container { display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; margin-top: 15px; }
        .way-card { background: #f5f7fa; padding: 15px 20px; border-radius: 10px; text-align: center; min-width: 150px; transition: all 0.3s; }
        .way-card.active { background: #667eea; color: white; transform: scale(1.05); }
        .way-expr { font-family: monospace; font-size: 16px; margin-bottom: 5px; }
        .way-result { font-size: 24px; font-weight: bold; }
        .tree-container { min-height: 200px; display: flex; justify-content: center; align-items: center; background: #f5f7fa; border-radius: 10px; padding: 20px; }
        #tree { width: 100%; max-width: 400px; }
        .result-box { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
        .result-item { width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; border-radius: 10px; font-weight: bold; font-size: 18px; background: #4caf50; color: white; }
        .status-box { background: #f5f7fa; border-radius: 10px; padding: 15px; font-family: monospace; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üßÆ Different Ways to Add Parentheses</h1>
        <p class="subtitle">Divide and Conquer - Split at each operator, combine results</p>

        <div class="controls">
            <button id="stepBtn">Step</button>
            <button id="autoBtn">Auto Run</button>
            <button id="resetBtn">Reset</button>
        </div>

        <div class="panel">
            <div class="panel-title">üìù Expression</div>
            <div class="expression" id="expr">2 * 3 - 4 * 5</div>
            <div class="ways-container" id="ways"></div>
        </div>

        <div class="panel">
            <div class="panel-title">üå≥ Current Evaluation Tree</div>
            <div class="tree-container">
                <svg id="tree"></svg>
            </div>
        </div>

        <div class="panel">
            <div class="panel-title">üìä All Possible Results</div>
            <div class="result-box" id="results"></div>
        </div>

        <div class="panel">
            <div class="panel-title">üìã Status</div>
            <div class="status-box" id="status">For each operator, split into left and right subexpressions, compute all combinations.</div>
        </div>
    </div>

    <script>
        const expression = "2*3-4*5";
        
        // All ways to parenthesize
        const allWays = [
            { expr: "((2*3)-(4*5))", tree: { op: '-', left: { op: '*', left: 2, right: 3 }, right: { op: '*', left: 4, right: 5 } }, result: -14 },
            { expr: "(2*((3-4)*5))", tree: { op: '*', left: 2, right: { op: '*', left: { op: '-', left: 3, right: 4 }, right: 5 } }, result: -10 },
            { expr: "(2*(3-(4*5)))", tree: { op: '*', left: 2, right: { op: '-', left: 3, right: { op: '*', left: 4, right: 5 } } }, result: -34 },
            { expr: "((2*(3-4))*5)", tree: { op: '*', left: { op: '*', left: 2, right: { op: '-', left: 3, right: 4 } }, right: 5 }, result: -10 },
            { expr: "(((2*3)-4)*5)", tree: { op: '*', left: { op: '-', left: { op: '*', left: 2, right: 3 }, right: 4 }, right: 5 }, result: 10 }
        ];

        let wayIdx = -1;
        let results = new Set();
        let done = false;
        let autoInterval = null;

        function render() {
            // Ways
            document.getElementById('ways').innerHTML = allWays.map((w, i) => {
                const active = i === wayIdx ? 'active' : '';
                return `<div class="way-card ${active}">
                    <div class="way-expr">${w.expr}</div>
                    <div class="way-result">= ${w.result}</div>
                </div>`;
            }).join('');

            // Results
            document.getElementById('results').innerHTML = results.size > 0
                ? [...results].sort((a, b) => a - b).map(r => `<div class="result-item">${r}</div>`).join('')
                : '<span style="color:#999;">None yet</span>';

            // Tree
            if (wayIdx >= 0 && wayIdx < allWays.length) {
                renderTree(allWays[wayIdx].tree);
            } else {
                d3.select("#tree").selectAll("*").remove();
            }
        }

        function renderTree(treeData) {
            const svg = d3.select("#tree");
            svg.selectAll("*").remove();
            
            const width = 350, height = 180;
            svg.attr("viewBox", `0 0 ${width} ${height}`);
            
            // Convert to d3 hierarchy format
            function toHierarchy(node) {
                if (typeof node === 'number') {
                    return { name: node.toString(), children: [] };
                }
                return {
                    name: node.op,
                    children: [toHierarchy(node.left), toHierarchy(node.right)]
                };
            }
            
            const root = d3.hierarchy(toHierarchy(treeData));
            const treeLayout = d3.tree().size([width - 60, height - 60]);
            treeLayout(root);
            
            const g = svg.append("g").attr("transform", "translate(30, 30)");
            
            // Links
            g.selectAll(".link")
                .data(root.links())
                .enter().append("path")
                .attr("fill", "none")
                .attr("stroke", "#999")
                .attr("stroke-width", 2)
                .attr("d", d3.linkVertical().x(d => d.x).y(d => d.y));
            
            // Nodes
            const nodes = g.selectAll(".node")
                .data(root.descendants())
                .enter().append("g")
                .attr("transform", d => `translate(${d.x},${d.y})`);
            
            nodes.append("circle")
                .attr("r", 20)
                .attr("fill", d => d.children ? "#667eea" : "#4caf50")
                .attr("stroke", d => d.children ? "#5a67d8" : "#2e7d32")
                .attr("stroke-width", 2);
            
            nodes.append("text")
                .attr("dy", 5)
                .attr("text-anchor", "middle")
                .attr("fill", "white")
                .attr("font-weight", "bold")
                .text(d => d.data.name);
        }

        function step() {
            if (done) return;

            wayIdx++;

            if (wayIdx >= allWays.length) {
                done = true;
                document.getElementById('status').innerHTML = 
                    `‚úÖ All ${allWays.length} ways evaluated! Results: [${[...results].sort((a,b)=>a-b).join(', ')}]`;
                document.getElementById('stepBtn').disabled = true;
                document.getElementById('autoBtn').disabled = true;
                stopAuto();
                render();
                return;
            }

            const way = allWays[wayIdx];
            results.add(way.result);
            
            document.getElementById('status').innerHTML = 
                `Way ${wayIdx + 1}: ${way.expr} = ${way.result}`;
            
            render();
        }

        function reset() {
            stopAuto();
            wayIdx = -1;
            results.clear();
            done = false;
            document.getElementById('stepBtn').disabled = false;
            document.getElementById('autoBtn').disabled = false;
            document.getElementById('status').innerHTML = 'For each operator, split into left and right subexpressions, compute all combinations.';
            render();
        }

        function stopAuto() {
            if (autoInterval) { clearInterval(autoInterval); autoInterval = null; }
            document.getElementById('autoBtn').textContent = 'Auto Run';
        }

        document.getElementById('stepBtn').onclick = () => { stopAuto(); step(); };
        document.getElementById('autoBtn').onclick = () => {
            if (autoInterval) { stopAuto(); }
            else { autoInterval = setInterval(step, 1000); document.getElementById('autoBtn').textContent = '‚è∏ Pause'; }
        };
        document.getElementById('resetBtn').onclick = reset;

        render();
    </script>
</body>
</html>
